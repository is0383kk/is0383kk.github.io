---
title: "更新検知メカニズム"
date: 2023-11-20T20:07:27+09:00
draft: true
categories: ["技術系","データベース"]
tags: []
---

## ■ 【前提】ACID特性とトランザクションの分離レベルの関係性
### ACID特性
ACID特性とはトランザクション処理には保持すべき４つの特性のことである。
|特性|要約|
| --- | --- |
|{{< rawhtml >}} 原子性 <br>Atomicity {{< /rawhtml >}}|口座Aから口座Bに対し1万円送金する場合、口座Aと口座Bへの操作はすべて実行される(または、されない) COMMIT or ROLLBACK|
|{{< rawhtml >}}一貫性 <br> Consistency {{< /rawhtml >}}|口座Aから口座Bに対し1万円送金する場合、口座A、口座Bが負数になるような操作はできない　|
|{{< rawhtml >}} 独立性 <br> Isolation {{< /rawhtml >}}|トランザクションは同時に実行しても、単独で実行しても同じ結果でなければならない|
|{{< rawhtml >}} 
永続性 <br> Durability
{{< /rawhtml >}}|トランザクションが完了したら、<br> 障害が発生してもその操作結果は失われない|

トランザクションの分離レベルとは、
{{< rawhtml >}} 
<font size="5"><b>独立性（Isolation）</b></font>
{{< /rawhtml >}}
に関する概念である。

## ■ トランザクションの分離レベル
分離レベルには以下のものがある。
| レベル | 説明 |
| --- | --- |
| {{< rawhtml >}} 
分離レベル0 <br> READ UNCOMMITTED
{{< /rawhtml >}} | コミットされていないレコードを他のトランザクションから参照できる |
| {{< rawhtml >}} 
分離レベル1 <br> READ COMMITTED
{{< /rawhtml >}} | コミットされたレコードを他のトランザクションから参照できる |
| {{< rawhtml >}} 
分離レベル2 <br> REPEATABLE READ
{{< /rawhtml >}} | トランザクション中は他のトランザクションでコミットされた更新を参照しない |
| {{< rawhtml >}} 
分離レベル3 <br> SERIALIZABLE
{{< /rawhtml >}} | トランザクションを順序付けて処理する |

また、分離レベルによって以下の弊害が生じます。
| 名称 | 説明 |
| --- | --- |
| ダーティリード | 他のトランザクションで更新された、コミット前のデータを読み込んでしまうこと |
| ファジーリード | 同じデータを２回読みとったとき、異なる内容となること |
| ファントムリード | 2回データを読み取ったとき、新しい内容が追加されてしまうこと |

上記をまとめるとこのようになる。※○は発生する
| 分離レベル | ダーティリード | ファジーリード | ファントムリード |
| --- | --- | --- | --- |
| READ UNCOMMITTED | ○ | ○ | ○ |
| READ COMMITTED | × | ○ | ○ |
| REPEATABLE READ | × | × | ○ |
| SERIALIZABLE | × | × | × |